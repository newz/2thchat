var nzchatobj=jQuery.noConflict(),nzsid=getcookie("sid",!0),nztime1=(new Date).getTime(),nztime2=0,nztouid=0,nzquota=0,nzlastid=0,nzonol="no",nzcommandz="",formhash="",nzChatPopupContent="",nzscroll=!0;function nzolover(){nzonol="yes"}function nzolout(){nzonol="no"}function nzalert(t){nzchatobj("#nzalertbox").text(t),nzchatobj("#nzalertbox").slideDown(),setTimeout(function(){nzchatobj("#nzalertbox").slideUp()},3e3)}function nzChatPopup(t){nzChatPopupContent=nzchatobj(t).next(".nzchatpopuph").html(),nzchatobj("#th_chat_popup_box").html(nzChatPopupContent),showWindow("th_chat_popup","plugin.php?id=th_chat:popup")}function nzChatBig(){nzchatheight<830&&(nzchatheight+=50,nzchatobj("#nzchatcontent").animate({height:nzchatheight},200),nzchatobj("#nzchatolcontent").animate({height:nzchatheight+4},200))}function nzChatSmall(){nzchatheight>230&&(nzchatheight-=50,nzchatobj("#nzchatcontent").animate({height:nzchatheight},200),nzchatobj("#nzchatolcontent").animate({height:nzchatheight+4},200))}function nzChatReset(){nzchatheight=nzchatdefaultheight,nzchatobj("#nzchatcontent").animate({height:nzchatheight},200),nzchatobj("#nzchatolcontent").animate({height:nzchatheight+4},200)}function nzSend(){var data=nzchatobj.trim(nzchatobj("#nzchatmessage").val());if(""===data)return!1;nztime1=(new Date).getTime(),nztime1>nztime2?(nzchatobj("#nzchatmessage").val(""),nztime2=nztime1+nzsetting.delay,nzchatobj.post("plugin.php?id=th_chat:post"+formhash,{text:data,lastid:nzlastid,touid:nztouid,quota:nzquota,command:nzcommandz},function(data){if("notice"==nzcommandz?(nzcommandz="",nzchatobj("#nznoticecheck").removeAttr("checked")):(nzcommandz="",nzchatobj(".nzchatrow").each(function(){"rgb(255, 187, 187)"==nzchatobj(this).css("background-color")&&nzchatobj(this).css("background-color","unset")})),nzquota>0&&nzTouid(0),data=JSON.parse(data),1==data.type)nzalert(data.error),1==data.script_add&&eval(data.script);else{var listmess=sortObject(data);if(nzReadyForScroll(),nzchatobj.each(listmess,function(t,n){(t=parseInt(t))>nzlastid&&(nzlastid=t,nzchatobj("#afterme").before(n),nzScrollChat())}),nzchatobj(".nzinnercontent img").one("load",function(){nzScrollChat()}),1==nzsetting.iscleardata){var nzchatrr=nzchatobj(".nzchatrow");nzchatrr.size()>nzsetting.chatrowmax&&nzchatrr.first().remove()}}})):nzalert("ส่งข้อความบ่อยไป")}function nzCommand(t,n){if(""==t)nzalert("คำสั่งผิดพลาด");else{if("del"==t)var a="ลบข้อความ",o=" "+nzchatobj("#nzchatcontent"+n).text();else{if("edit"==t){var c=!1;return nzchatobj(".nzchatrow").each(function(){if("rgb(255, 187, 187)"==nzchatobj(this).css("background-color")&&(nzchatobj(this).css("background-color","unset"),nzchatobj("#nzchatmessage").val()==nzchatobj("#nzchatcontent"+n).text()&&nzchatobj("#nzchatmessage").val(""),nzchatobj(this).attr("id")=="nzrows_"+n))return nzcommandz="",void(c=!0)}),"notice"==nzcommandz&&nzchatobj("#nznoticecheck").removeAttr("checked"),c?void 0:(nzcommandz="edit "+n,nzchatobj("#nzrows_"+n).css("background-color","#fbb"),nzchatobj("#nzchatmessage").val(nzchatobj("#nzchatcontent"+n).text()),void nzchatobj("#nzchatmessage").focus())}if("ban"==t)a="แบน",o=" "+nzchatobj("#nzolpro_"+n).text()+"(UID: "+n+")";else if("unban"==t)a="ปลดแบน",o=" "+nzchatobj("#nzolpro_"+n).text()+"(UID: "+n+")";else if("point"==t){a="ให้คะแนน";var e=n.split("|");o=" "+e[1]+" แก่ "+nzchatobj("#nzolpro_"+e[0]).text()+"(UID: "+n+")"}else if("clear"==t)a="ล้างห้องแชท",o=""}1==confirm("คุณต้องการที่จะ"+a+o+" ?")&&(nzchatobj("#nzchatmessage").val("!"+t+" "+n),nzSend())}}function nzLoadTextInit(){nzchatobj.post("plugin.php?id=th_chat:newinit",function(t){t=JSON.parse(t),nzlastid=t.lastid,nzchatobj("#nzchatcontent").html('<table class="nzcallrow">'+t.datahtml+'<tr id="afterme" style="height:0px;"><td class="nzavatart"></td><td class="nzcontentt"></td></tr></table>'),nzScrollChat(!0),nzchatobj(".nzinnercontent img").one("load",function(){nzScrollChat()}),"no"==nzonol&&nzchatobj("#nzchatolcontent").html(t.datachatonline),nzchatobj("#nzoltotal").html(t.chat_online_total),nzchatobj("#nzchatnotice").html(t.welcometext),setTimeout(nzLoadText,nzsetting.reload)})}function nzScrollChat(t=!1){var n=document.getElementById("nzchatcontent");t&&(nzscroll=!0,nzchatobj("#nznewmessage").hide()),nzscroll?n.scrollTop=n.scrollHeight:nzchatobj("#nznewmessage").show()}function nzReadyForScroll(){var t=document.getElementById("nzchatcontent");nzscroll=t.scrollHeight-t.scrollTop==nzchatheight+4}function nzLoadText(){nzchatobj.post("plugin.php?id=th_chat:new",{lastid:nzlastid},function(t){if("not"!=t){var n=sortObject((t=JSON.parse(t)).chat_row);if(nzReadyForScroll(),nzchatobj.each(n,function(t,n){(t=parseInt(t))>nzlastid&&(nzlastid=t,nzchatobj("#afterme").before(n),nzScrollChat())}),nzchatobj(".nzinnercontent img").one("load",function(){nzScrollChat()}),1==nzsetting.iscleardata){var a=nzchatobj(".nzchatrow");a.size()>nzsetting.chatrowmax&&a.first().remove()}t.chat_online&&("no"==nzonol&&nzchatobj("#nzchatolcontent").html(t.chat_online),nzchatobj("#nzoltotal").html(t.chat_online_total))}}),setTimeout(nzLoadText,nzsetting.reload)}function nzQuota(t){nzTouid(0),nzchatobj("#nztouid").html("<span style='color:#3366CC'>อ้างอิง</span>: "+nzchatobj("#nzchatcontent"+t).html()+" <a href='javascript:void(0);' onClick='nzTouid(0)'>(ยกเลิก)</a>"),nzquota=t,nzchatobj("#nzchatmessage").focus()}function nzAt(t){seditor_insertunit("nzchat","@"+t+" ",""),nzchatobj("#nzchatmessage").focus()}function nzTouid(t){t>0?(nzTouid(0),nzchatobj("#nztouid").html("<span style='color:#3366CC'>กระซิบ:</span> <a href='home.php?mod=space&uid="+t+"' class='nzca' target='_blank'>"+nzchatobj(".nzat_"+t).last()[0].outerHTML+"</a> ["+t+"] <a href='javascript:void(0);' onClick='nzTouid(0)'>(ยกเลิก)</a>"),nztouid=t):(nzchatobj("#nztouid").html(""),nztouid=0,nzquota=0)}function nzReload(){nzchatobj("#nzchatolcontent").html(""),nzchatobj("#nzchatnotice").html("กำลังโหลดประกาศล่าสุด..."),nzchatobj("#nzchatcontent").html('<br /><br /><br /><br /><br /><br /><center><img src="source/plugin/th_chat/images/loading.svg" alt="Load" /></center>'),nzchatobj.post("plugin.php?id=th_chat:newinit",function(t){t=JSON.parse(t),nzlastid=t.lastid,nzchatobj("#nzchatcontent").html('<table class="nzcallrow">'+t.datahtml+'<tr id="afterme" style="height:0px;"><td class="nzavatart"></td><td class="nzcontentt"></td></tr></table>'),nzScrollChat(!0),nzchatobj(".nzinnercontent img").one("load",function(){nzScrollChat()}),nzchatobj("#nzchatolcontent").html(t.datachatonline),nzchatobj("#nzchatnotice").html(t.welcometext)})}function nzClean(){nzchatobj(".nzchatrow").fadeOut("slow")}function nzCheckImg(t){var n=parseInt(t.width),a=parseInt(t.height);n>500&&(t.style.cursor="pointer",t.onclick=function(){window.open(this.src,"ImageViewer","resizable=1").focus()},a*=500/n,n=500,t.height=a,t.width=n),a>240&&(t.style.cursor="pointer",t.onclick=function(){window.open(this.src,"ImageViewer","resizable=1").focus()},t.width=240/a*n,t.height=240)}function nzPlusone(t,n){var a=prompt("เหตุผล");null==a&&(a=""),nzCommand("point",t+"|"+n+"|"+a)}function sortObject(t){var n,a={},o=[];for(n in t)t.hasOwnProperty(n)&&o.push(n);for(o.sort(),n=0;n<o.length;n++)a[o[n]]=t[o[n]];return a}nzchatobj(function(){nzchatobj("#nzchatmessage").keydown(function(t){"13"==t.keyCode&&nzSend()}),nzchatobj("#nznoticecheck").change(function(t){nzchatobj(this).is(":checked")?(nzcommandz="notice",nzchatobj(".nzchatrow").each(function(){"rgb(255, 187, 187)"==nzchatobj(this).css("background-color")&&nzchatobj(this).css("background-color","unset")}),nzchatobj("#nzchatmessage").val(nzchatobj("#nzchatnotice").text()),nzchatobj("#nzchatmessage").focus()):(nzchatobj("#nzchatmessage").val()==nzchatobj("#nzchatnotice").text()&&(nzchatobj("#nzchatmessage").val(""),nzchatobj("#nzchatmessage").focus()),nzcommandz="")}),nzchatobj("#nzchatmessage").bind("paste",function(t){if(1===t.originalEvent.clipboardData.files.length){nzchatobj("#nzimguploadl").text("กำลังอัปโหลด..."),nzchatobj("#nzimgupload").prop("disabled",!0);var n=new FormData;n.append("pictures",t.originalEvent.clipboardData.files[0]),nzchatobj("#nzimgupload").val(""),nzchatobj.ajax({url:"plugin.php?id=th_chat:img",type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(t,n,a){void 0===t.error?(seditor_insertunit("nzchat","[img]"+t.url+"[/img]",""),nzchatobj("#nzchatmessage").focus()):nzalert(t.error)},error:function(t,n,a){nzalert("เกิดข้อผิดพลาด: "+n)},complete:function(t,n,a){nzchatobj("#nzimguploadl").text("อัปโหลดไฟล์ภาพ"),nzchatobj("#nzimgupload").prop("disabled",!1)}})}}),nzchatobj("#nzimgup").click(function(){nzchatobj("#nzimgupload").click()}),nzchatobj("#nzimgupload").change(function(){if(nzchatobj("#nzimgupload").val()){nzchatobj("#nzimguploadl").text("กำลังอัปโหลด..."),nzchatobj("#nzimgupload").prop("disabled",!0);var t=new FormData;t.append("pictures",nzchatobj("#nzimgupload").prop("files")[0]),nzchatobj("#nzimgupload").val(""),nzchatobj.ajax({url:"plugin.php?id=th_chat:img",type:"POST",data:t,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(t,n,a){void 0===t.error?(seditor_insertunit("nzchat","[img]"+t.url+"[/img]",""),nzchatobj("#nzchatmessage").focus()):nzalert(t.error)},error:function(t,n,a){nzalert("เกิดข้อผิดพลาด: "+n)},complete:function(t,n,a){nzchatobj("#nzimguploadl").text("อัปโหลดไฟล์ภาพ"),nzchatobj("#nzimgupload").prop("disabled",!1)}})}}),1==nzsetting.autoconnect&&nzLoadTextInit();nzchatobj("#nzemoji");const t=new EmojiButton;t.on("emoji",t=>{nzchatobj("#nzchatmessage").val(nzchatobj("#nzchatmessage").val()+t)}),nzchatobj("#nzemoji").click(function(){t.togglePicker(this)}),nzchatobj("#nznewmessage").click(function(){nzScrollChat(!0)}),nzchatobj("#nzchatmessage").keydown(function(t){"13"==t.keyCode&&nzSend()}),nzchatobj("#nzchatcontent").scroll(function(){var t=document.getElementById("nzchatcontent");t.scrollHeight-t.scrollTop==nzchatheight+4&&(nzchatobj("#nznewmessage").hide(),t.scrollTop=t.scrollHeight)})});