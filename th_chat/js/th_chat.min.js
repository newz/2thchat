var nzchatobj=jQuery.noConflict(),nzsid=getcookie("sid",!0),nztime1=(new Date).getTime(),nztime2=0,nztouid=0,nzquota=0,nzlastid=0,nzonol=!1,nzcommandz="",formhash="",nzChatPopupContent="",nzscroll=!0;function nzolover(){nzonol=!0}function nzolout(){nzonol=!1}function nzalert(t){nzchatobj("#nzalertbox").text(t),nzchatobj("#nzalertbox").slideDown(),setTimeout(function(){nzchatobj("#nzalertbox").slideUp()},3e3)}function nzNotice(){nzcommandz="notice",nzchatobj(".nzquoteboxi").html('<div><span class="nzquoteboxh">แก้ไขประกาศ</span>: '+nzchatobj("#nzchatnotice").html()+'</div><div class="nzcancel" onclick="nzTouid(0)" title="ยกเลิก"></div>'),nzchatobj(".nzquoteboxo").show(),nzchatobj("#nzchatcontent").css("height",nzchatheight-nzchatobj(".nzquoteboxo").height()-2),nzScrollChat(!0),nzchatobj("#nzchatmessage").val(nzchatobj("#nzchatnotice").text()),nzchatobj("#nzchatmessage").focus()}function nzChatPopup(t){nzChatPopupContent=nzchatobj(t).next(".nzchatpopuph").html(),nzchatobj("#th_chat_popup_box").html(nzChatPopupContent),showWindow("th_chat_popup","plugin.php?id=th_chat:popup")}function nzChatBig(){nzchatheight<830&&(nzchatheight+=50,nzchatobj("#nzchatcontent").animate({height:nzchatheight},200),nzchatobj("#nzchatolcontent").animate({height:nzchatheight},200))}function nzChatSmall(){nzchatheight>230&&(nzchatheight-=50,nzchatobj("#nzchatcontent").animate({height:nzchatheight},200),nzchatobj("#nzchatolcontent").animate({height:nzchatheight},200))}function nzChatReset(){nzchatheight=nzchatdefaultheight,nzchatobj("#nzchatcontent").animate({height:nzchatheight},200),nzchatobj("#nzchatolcontent").animate({height:nzchatheight},200)}function nzSend(){var data=nzchatobj.trim(nzchatobj("#nzchatmessage").val());if(""===data)return!1;nztime1=(new Date).getTime(),nztime1>nztime2?(nzchatobj("#nzchatmessage").val(""),nztime2=nztime1+nzsetting.delay,nzchatobj.post("plugin.php?id=th_chat:post"+formhash,{text:data,lastid:nzlastid,touid:nztouid,quota:nzquota,command:nzcommandz},function(data){if((nzquota>0||"notice"==nzcommandz||"edit"==nzcommandz.substr(0,4))&&nzTouid(0),data=JSON.parse(data),1==data.type)nzalert(data.error),1==data.script_add&&eval(data.script);else{var listmess=sortObject(data);if(nzReadyForScroll(),nzchatobj.each(listmess,function(t,n){(t=parseInt(t))>nzlastid&&(nzlastid=t,nzchatobj("#afterme").before(n),nzScrollChat())}),nzchatobj(".nzinnercontent img").one("load",function(){nzScrollChat()}),1==nzsetting.iscleardata){var nzchatrr=nzchatobj(".nzchatrow");nzchatrr.size()>nzsetting.chatrowmax&&nzchatrr.first().remove()}}})):nzalert("ส่งข้อความบ่อยไป")}function nzCommand(t,n){if(""==t)nzalert("คำสั่งผิดพลาด");else{if("del"==t)var o="ลบข้อความ",a=" "+nzchatobj("#nzchatcontent"+n).text();else{if("edit"==t)return nzTouid(0),nzcommandz="edit "+n,nzchatobj(".nzquoteboxi").html('<div><div class="nzquoteboxh">แก้ไขข้อความ</div>'+nzchatobj("#nzrows_"+n+" .nzinnercontent")[0].outerHTML+'</div><div class="nzcancel" onclick="nzTouid(0)" title="ยกเลิก"></div>'),nzchatobj(".nzquoteboxi .nzcq").remove(),nzchatobj(".nzquoteboxo").show(),nzchatobj("#nzchatcontent").css("height",nzchatheight-nzchatobj(".nzquoteboxo").height()-2),nzScrollChat(!0),nzchatobj("#nzchatmessage").val(nzchatobj("#nzchatcontent"+n).text()),void nzchatobj("#nzchatmessage").focus();if("ban"==t)o="แบน",a=" "+nzchatobj("#nzolpro_"+n).text()+"(UID: "+n+")";else if("unban"==t)o="ปลดแบน",a=" "+nzchatobj("#nzolpro_"+n).text()+"(UID: "+n+")";else if("point"==t){o="ให้คะแนน";var e=n.split("|");a=" "+e[1]+" แก่ "+nzchatobj("#nzolpro_"+e[0]).text()+"(UID: "+n+")"}else if("clear"==t)o="ล้างห้องแชท",a=""}1==confirm("คุณต้องการที่จะ"+o+a+" ?")&&(nzchatobj("#nzchatmessage").val("!"+t+" "+n),nzSend())}}function nzLoadTextInit(){nzchatobj.post("plugin.php?id=th_chat:newinit",function(t){t=JSON.parse(t),nzlastid=t.lastid,nzchatobj("#nzchatcontent").html('<table class="nzcallrow">'+t.datahtml+'<tr id="afterme"><td colspan="2"></td></tr></table>'),nzScrollChat(!0),nzchatobj(".nzinnercontent img").one("load",function(){nzScrollChat()}),nzonol||nzchatobj("#nzchatolcontent").html(t.datachatonline),nzchatobj("#nzoltotal").html(t.chat_online_total),nzchatobj("#nzchatnotice").html(t.welcometext),setTimeout(nzLoadText,nzsetting.reload)})}function nzScrollChat(t=!1){var n=document.getElementById("nzchatcontent");t&&(nzscroll=!0,nzchatobj("#nznewmessage").hide()),nzscroll?n.scrollTop=n.scrollHeight:nzchatobj("#nznewmessage").show()}function nzReadyForScroll(){var t=document.getElementById("nzchatcontent");nzscroll=!!nzchatobj(".nzquoteboxo:visible")||t.scrollHeight-t.scrollTop==nzchatheight}function nzLoadText(){nzchatobj.post("plugin.php?id=th_chat:new",{lastid:nzlastid},function(t){if("not"!=t){var n=sortObject((t=JSON.parse(t)).chat_row);if(nzReadyForScroll(),nzchatobj.each(n,function(t,n){(t=parseInt(t))>nzlastid&&(nzlastid=t,nzchatobj("#afterme").before(n),nzScrollChat())}),nzchatobj(".nzinnercontent img").one("load",function(){nzScrollChat()}),1==nzsetting.iscleardata){var o=nzchatobj(".nzchatrow");o.size()>nzsetting.chatrowmax&&o.first().remove()}t.chat_online&&(nzonol||nzchatobj("#nzchatolcontent").html(t.chat_online),nzchatobj("#nzoltotal").html(t.chat_online_total))}}),setTimeout(nzLoadText,nzsetting.reload)}function nzQuota(t){nzTouid(0),nzchatobj(".nzquoteboxi").html('<div class="nzinnercontent"><div class="nzblockquote">'+nzchatobj("#nzrows_"+t+" .nzuserat2")[0].outerHTML+": "+nzchatobj("#nzchatcontent"+t).html()+'</div></div><div class="nzcancel" onclick="nzTouid(0)" title="ยกเลิก"></div>'),nzchatobj(".nzquoteboxi .nzcq").remove(),nzchatobj(".nzquoteboxi .nzuserat2").toggleClass("nzuserat2 nzuserat"),nzchatobj(".nzquoteboxo").show(),nzchatobj("#nzchatcontent").css("height",nzchatheight-nzchatobj(".nzquoteboxo").height()-2),nzScrollChat(!0),nzquota=t,nzchatobj("#nzchatmessage").focus()}function nzAt(t){seditor_insertunit("nzchat","@"+t+" ",""),nzchatobj("#nzchatmessage").focus()}function nzTouid(t){t>0?(nzTouid(0),nzchatobj(".nzquoteboxi").html('<div><span class="nzquoteboxh">กระซิบถึง</span> <img src="uc_server/avatar.php?uid='+t+'&size=small" class="nzchatavatar" width="32" height="32" onerror="this.src=\'uc_server/images/noavatar_small.gif\';" align="absmiddle"> '+nzchatobj(".nzat_"+t).last()[0].outerHTML+'</div><div class="nzcancel" onclick="nzTouid(0)" title="ยกเลิก"></div>'),nzchatobj(".nzquoteboxi .nzcq").remove(),nzchatobj(".nzquoteboxi .nzinnercontent").remove(),nzchatobj(".nzquoteboxo").show(),nzchatobj("#nzchatcontent").css("height",nzchatheight-nzchatobj(".nzquoteboxo").height()-2),nzScrollChat(!0),nztouid=t):(nzchatobj("#nzchatcontent").css("height",nzchatheight),"edit"==nzcommandz.substr(0,4)?nzchatobj(".nzquoteboxi .nzinnercontent").text()==nzchatobj("#nzchatmessage").val()&&nzchatobj("#nzchatmessage").val(""):"notice"==nzcommandz&&nzchatobj("#nzchatmessage").val()==nzchatobj("#nzchatnotice").text()&&nzchatobj("#nzchatmessage").val(""),nzchatobj(".nzquoteboxi").html(""),nzchatobj("#nztouid").html(""),nzchatobj(".nzquoteboxo").hide(),nztouid=0,nzquota=0,nzcommandz="")}function nzReload(){nzchatobj("#nzchatolcontent").html(""),nzchatobj("#nzchatnotice").html("กำลังโหลดประกาศล่าสุด..."),nzchatobj("#nzchatcontent").html('<br /><br /><br /><br /><br /><br /><center><img src="source/plugin/th_chat/images/loading.svg" alt="Load" /></center>'),nzchatobj.post("plugin.php?id=th_chat:newinit",function(t){t=JSON.parse(t),nzlastid=t.lastid,nzchatobj("#nzchatcontent").html('<table class="nzcallrow">'+t.datahtml+'<tr id="afterme" style="display: none;"><td class="nzavatart"></td><td class="nzcontentt"></td></tr></table>'),nzScrollChat(!0),nzchatobj(".nzinnercontent img").one("load",function(){nzScrollChat()}),nzchatobj("#nzchatolcontent").html(t.datachatonline),nzchatobj("#nzchatnotice").html(t.welcometext)})}function nzClean(){nzchatobj(".nzchatrow").fadeOut("slow")}function nzCheckImg(t){var n=parseInt(t.width),o=parseInt(t.height);n>500&&(t.style.cursor="pointer",t.onclick=function(){window.open(this.src,"ImageViewer","resizable=1").focus()},o*=500/n,n=500,t.height=o,t.width=n),o>240&&(t.style.cursor="pointer",t.onclick=function(){window.open(this.src,"ImageViewer","resizable=1").focus()},t.width=240/o*n,t.height=240)}function nzPlusone(t,n){var o=prompt("เหตุผล");null==o&&(o=""),nzCommand("point",t+"|"+n+"|"+o)}function sortObject(t){var n,o={},a=[];for(n in t)t.hasOwnProperty(n)&&a.push(n);for(a.sort(),n=0;n<a.length;n++)o[a[n]]=t[a[n]];return o}nzchatobj(function(){nzchatobj("#nzchatmessage").keydown(function(t){"13"==t.keyCode&&nzSend(),"27"==t.keyCode&&nzTouid(0)}),nzchatobj("#nzchatmessage").bind("paste",function(t){if(1===t.originalEvent.clipboardData.files.length){nzchatobj("#nzimguploadl").text("กำลังอัปโหลด..."),nzchatobj("#nzimgupload").prop("disabled",!0);var n=new FormData;n.append("pictures",t.originalEvent.clipboardData.files[0]),nzchatobj("#nzimgupload").val(""),nzchatobj.ajax({url:"plugin.php?id=th_chat:img",type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(t,n,o){void 0===t.error?(seditor_insertunit("nzchat","[img]"+t.url+"[/img]",""),nzchatobj("#nzchatmessage").focus()):nzalert(t.error)},error:function(t,n,o){nzalert("เกิดข้อผิดพลาด: "+n)},complete:function(t,n,o){nzchatobj("#nzimguploadl").text("อัปโหลดไฟล์ภาพ"),nzchatobj("#nzimgupload").prop("disabled",!1)}})}}),nzchatobj("#nzimgup").click(function(){nzchatobj("#nzimgupload").click()}),nzchatobj("#nzimgupload").change(function(){if(nzchatobj("#nzimgupload").val()){nzchatobj("#nzimguploadl").text("กำลังอัปโหลด..."),nzchatobj("#nzimgupload").prop("disabled",!0);var t=new FormData;t.append("pictures",nzchatobj("#nzimgupload").prop("files")[0]),nzchatobj("#nzimgupload").val(""),nzchatobj.ajax({url:"plugin.php?id=th_chat:img",type:"POST",data:t,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(t,n,o){void 0===t.error?(seditor_insertunit("nzchat","[img]"+t.url+"[/img]",""),nzchatobj("#nzchatmessage").focus()):nzalert(t.error)},error:function(t,n,o){nzalert("เกิดข้อผิดพลาด: "+n)},complete:function(t,n,o){nzchatobj("#nzimguploadl").text("อัปโหลดไฟล์ภาพ"),nzchatobj("#nzimgupload").prop("disabled",!1)}})}}),1==nzsetting.autoconnect&&nzLoadTextInit();nzchatobj("#nzemoji");const t=new EmojiButton;t.on("emoji",t=>{nzchatobj("#nzchatmessage").val(nzchatobj("#nzchatmessage").val()+t)}),nzchatobj("#nzemoji").click(function(){t.togglePicker(this)}),nzchatobj("#nznewmessage").click(function(){nzScrollChat(!0)}),nzchatobj("#nzchatmessage").keydown(function(t){"13"==t.keyCode&&nzSend()}),nzchatobj("#nzchatcontent").scroll(function(){var t=document.getElementById("nzchatcontent");t.scrollHeight-t.scrollTop==nzchatheight&&(nzchatobj("#nznewmessage").hide(),t.scrollTop=t.scrollHeight)})});